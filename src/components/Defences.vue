<template>
  <div class="defence-stats d-flex justify-content-center">
    <table class="stat-sheet">
      <tbody>
        <tr class="tr-head">
          <td>Physical Def</td>
          <td>
            <input type="text" readonly v-model="physicalDefence.physical">
          </td>
        </tr>
        <tr class="tr-subhead">
          <td>
            VS strike
          </td>
          <td>
            <input type="text" readonly v-model="physicalDefence.strike">
          </td>
        </tr>
        <tr class="tr-subhead">
          <td>
            VS slash
          </td>
          <td>
            <input type="text" readonly v-model="physicalDefence.slash">
          </td>
        </tr>
        <tr class="tr-subhead">
          <td>
            VS thrust
          </td>
          <td>
            <input type="text" readonly v-model="physicalDefence.thrust">
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</template>

<script>


export default {
  name: 'defence-stats',
  props: {
    characterStats: {
      type: Object,
      required: true,
    },
  },
  data: () => ({
    physicalDefence: {
      physical: 0,
      strike: 0,
      slash: 0,
      thrust : 0
    },
    elementalDefence: {
      magic: 0,
      flame: 0,
      lightning: 0
    },
    statSum : 0,
    characterResistanceStat: 0,
    physicalDefenceTable: {
      82 : 12,
      83 : 13,
      84 : 14,
      85 : 16,
      86 : 17,
      87 : 18,
      88 : 20,
      89 : 21,
      90 : 22,
      91 : 24,
      92 : 25,
      93 : 26,
      94 : 28,
      95 : 29,
      96 : 30,
      97 : 32,
      98 : 33,
      99 : 34,
      100 : 36,
      101 : 37,
      102 : 38,
      103 : 40,
      104 : 41,
      105 : 42,
      106 : 44,
      107 : 45,
      108 : 46,
      109 : 48,
      110 : 49,
      111 : 50,
      112 : 52,
      113 : 53,
      114 : 54,
      115 : 55,
      116 : 57,
      117 : 58,
      118 : 59,
      119 : 61,
      120 : 62,
      121 : 63,
      122 : 64,
      123 : 66,
      124 : 67,
      125 : 68,
      126 : 70,
      127 : 71,
      128 : 72,
      129 : 73,
      130 : 75,
      131 : 76,
      132 : 77,
      133 : 78,
      134 : 80,
      135 : 81,
      136 : 82,
      137 : 83,
      138 : 85,
      139 : 86,
      140 : 87,
      141 : 88,
      142 : 89,
      143 : 91,
      144 : 92,
      145 : 93,
      146 : 94,
      147 : 95,
      148 : 97,
      149 : 98,
      150 : 99,
      151 : 100,
      152 : 101,
      153 : 102,
      154 : 104,
      155 : 105,
      156 : 106,
      157 : 107,
      158 : 108,
      159 : 109,
      160 : 110,
      161 : 111,
      162 : 112,
      163 : 114,
      164 : 115,
      165 : 116,
      166 : 117,
      167 : 118,
      168 : 119,
      169 : 119,
      170 : 120,
      171 : 121,
      172 : 121,
      173 : 122,
      174 : 122,
      175 : 123,
      176 : 123,
      177 : 124,
      178 : 124,
      179 : 125,
      180 : 125,
      181 : 126,
      182 : 127,
      183 : 127,
      184 : 128,
      185 : 128,
      186 : 129,
      187 : 129,
      188 : 130,
      189 : 130,
      190 : 131,
      191 : 131,
      192 : 132,
      193 : 132,
      194 : 133,
      195 : 133,
      196 : 134,
      197 : 134,
      198 : 135,
      199 : 135,
      200 : 136,
      201 : 136,
      202 : 137,
      203 : 137,
      204 : 138,
      205 : 138,
      206 : 139,
      207 : 139,
      208 : 140,
      209 : 140,
      210 : 141,
      211 : 141,
      212 : 142,
      213 : 142,
      214 : 143,
      215 : 143,
      216 : 144,
      217 : 144,
      218 : 145,
      219 : 145,
      220 : 146,
      221 : 146,
      222 : 147,
      223 : 147,
      224 : 148,
      225 : 148,
      226 : 149,
      227 : 149,
      228 : 149,
      229 : 150,
      230 : 150,
      231 : 151,
      232 : 151,
      233 : 152,
      234 : 152,
      235 : 153,
      236 : 153,
      237 : 154,
      238 : 154,
      239 : 154,
      240 : 155,
      241 : 155,
      242 : 156,
      243 : 156,
      244 : 157,
      245 : 157,
      246 : 158,
      247 : 158,
      248 : 158,
      249 : 159,
      250 : 159,
      251 : 160,
      252 : 160,
      253 : 160,
      254 : 161,
      255 : 161,
      256 : 162,
      257 : 162,
      258 : 162,
      259 : 163,
      260 : 163,
      261 : 164,
      262 : 164
    },
    physicalDefence99Table: {
      171 : 164,
      172 : 164,
      173 : 165,
      174 : 165,
      175 : 166,
      176 : 166,
      177 : 166,
      178 : 167,
      179 : 167,
      180 : 167,
      181 : 168,
      182 : 168,
      183 : 168,
      184 : 169,
      185 : 169,
      186 : 169,
      187 : 169,
      188 : 170,
      189 : 170,
      190 : 170,
      191 : 170,
      192 : 170,
      193 : 170,
      194 : 170,
      195 : 170,
      196 : 170,
      197 : 170,
      198 : 170,
      199 : 170,
      200 : 171,
      201 : 171,
      202 : 171,
      203 : 171,
      204 : 171,
      205 : 171,
      206 : 171,
      207 : 171,
      208 : 171,
      209 : 171,
      210 : 171,
      211 : 171,
      212 : 171,
      213 : 171,
      214 : 171,
      215 : 171,
      216 : 171,
      217 : 171,
      218 : 171,
      219 : 171,
      220 : 172,
      221 : 172,
      222 : 172,
      223 : 172,
      224 : 172,
      225 : 172,
      226 : 172,
      227 : 172,
      228 : 172,
      229 : 172,
      230 : 172,
      231 : 172,
      232 : 172,
      233 : 172,
      234 : 172,
      235 : 172,
      236 : 172,
      237 : 172,
      238 : 172,
      239 : 172,
      240 : 173,
      241 : 173,
      242 : 173,
      243 : 173,
      244 : 173,
      245 : 173,
      246 : 173,
      247 : 173,
      248 : 173,
      249 : 173,
      250 : 173,
      251 : 173,
      252 : 173,
      253 : 173,
      254 : 173,
      255 : 173,
      256 : 173,
      257 : 173,
      258 : 173,
      259 : 173,
      260 : 174,
      261 : 174,
      262 : 174,
      263 : 174,
      264 : 174,
      265 : 174,
      266 : 174,
      267 : 174,
      268 : 174,
      269 : 174,
      270 : 174,
      271 : 174,
      272 : 174,
      273 : 174,
      274 : 174,
      275 : 174,
      276 : 174,
      277 : 174,
      278 : 174,
      279 : 174,
      280 : 175,
      281 : 175,
      282 : 175,
      283 : 175,
      284 : 175,
      285 : 175,
      286 : 175,
      287 : 175,
      288 : 175,
      289 : 175,
      290 : 175,
      291 : 175,
      292 : 175,
      293 : 175,
      294 : 175,
      295 : 175,
      296 : 175,
      297 : 175,
      298 : 175,
      299 : 175,
      300 : 176,
      301 : 176,
      302 : 176,
      303 : 176,
      304 : 176,
      305 : 176,
      306 : 176,
      307 : 176,
      308 : 176,
      309 : 176,
      310 : 176,
      311 : 176,
      312 : 176,
      313 : 176,
      314 : 176,
      315 : 176,
      316 : 176,
      317 : 176,
      318 : 176,
      319 : 176,
      320 : 177,
      321 : 177,
      322 : 177,
      323 : 177,
      324 : 177,
      325 : 177,
      326 : 177,
      327 : 177,
      328 : 177,
      329 : 177,
      330 : 177,
      331 : 177,
      332 : 177,
      333 : 177,
      334 : 177,
      335 : 177,
      336 : 177,
      337 : 177,
      338 : 177,
      339 : 177,
      340 : 178,
      341 : 178,
      342 : 178,
      343 : 178,
      344 : 178,
      345 : 178,
      346 : 178,
      347 : 178,
      348 : 178,
      349 : 178,
      350 : 178,
      351 : 178,
      352 : 178,
      353 : 178,
      354 : 178,
      355 : 178,
      356 : 178,
      357 : 178,
      358 : 178,
      359 : 178,
      360 : 179,
      361 : 179,
      362 : 179,
      363 : 179,
      364 : 179,
      365 : 179,
      366 : 179,
      367 : 179,
      368 : 179,
      369 : 179,
      370 : 179,
      371 : 179,
      372 : 179,
      373 : 179,
      374 : 179,
      375 : 179,
      376 : 179,
      377 : 179,
      378 : 179,
      379 : 179,
      380 : 180,
      381 : 180,
      382 : 180,
      383 : 180,
      384 : 180,
      385 : 180,
      386 : 180,
      387 : 180,
      388 : 180,
      389 : 180,
      390 : 180,
      391 : 180,
      392 : 180,
      393 : 180,
      394 : 180,
      395 : 180,
      396 : 180,
      397 : 180,
      398 : 180,
      399 : 180,
      400 : 181,
      401 : 181,
      402 : 181,
      403 : 181,
      404 : 181,
      405 : 181,
      406 : 181,
      407 : 181,
      408 : 181,
      409 : 181,
      410 : 181,
      411 : 181,
      412 : 181,
      413 : 181,
      414 : 181,
      415 : 181,
      416 : 181,
      417 : 181,
      418 : 181,
      419 : 181,
      420 : 182,
      421 : 182,
      422 : 182,
      423 : 182,
      424 : 182,
      425 : 182,
      426 : 182,
      427 : 182,
      428 : 182,
      429 : 182,
      430 : 182,
      431 : 182,
      432 : 182,
      433 : 182,
      434 : 182,
      435 : 182,
      436 : 182,
      437 : 182,
      438 : 182,
      439 : 182,
      440 : 183,
      441 : 183,
      442 : 183,
      443 : 183,
      444 : 183,
      445 : 183,
      446 : 183,
      447 : 183,
      448 : 183,
      449 : 183,
      450 : 183,
      451 : 183,
      452 : 183,
      453 : 183,
      454 : 183,
      455 : 183,
      456 : 183,
      457 : 183,
      458 : 183,
      459 : 183,
      460 : 184,
      461 : 184,
      462 : 184,
      463 : 184,
      464 : 184,
      465 : 184,
      466 : 184,
      467 : 184,
      468 : 184,
      469 : 184,
      470 : 184,
      471 : 184,
      472 : 184,
      473 : 184,
      474 : 184,
      475 : 184,
      476 : 184,
      477 : 184,
      478 : 184,
      479 : 184,
      480 : 185,
      481 : 185,
      482 : 185,
      483 : 185,
      484 : 185,
      485 : 185,
      486 : 185,
      487 : 185,
      488 : 185,
      489 : 185,
      490 : 185,
      491 : 185,
      492 : 185,
      493 : 185,
      494 : 185,
      495 : 185,
      496 : 185,
      497 : 185,
      498 : 185,
      499 : 185,
      500 : 186,
      501 : 186,
      502 : 186,
      503 : 186,
      504 : 186,
      505 : 186,
      506 : 186,
      507 : 186,
      508 : 186,
      509 : 186,
      510 : 186,
      511 : 186,
      512 : 186,
      513 : 186,
      514 : 186,
      515 : 186,
      516 : 186,
      517 : 186,
      518 : 186,
      519 : 186,
      520 : 187,
      521 : 187,
      522 : 187,
      523 : 187,
      524 : 187,
      525 : 187,
      526 : 187,
      527 : 187,
      528 : 187,
      529 : 187,
      530 : 187,
      531 : 187,
      532 : 187,
      533 : 187,
      534 : 187,
      535 : 187,
      536 : 187,
      537 : 187,
      538 : 187,
      539 : 187,
      540 : 188,
      541 : 188,
      542 : 188,
      543 : 188,
      544 : 188,
      545 : 188,
      546 : 188,
      547 : 188,
      548 : 188,
      549 : 188,
      550 : 188,
      551 : 188,
      552 : 188,
      553 : 188,
      554 : 188,
      555 : 188,
      556 : 188,
      557 : 188,
      558 : 188,
      559 : 188,
      560 : 189,
      561 : 189,
      562 : 189,
      563 : 189,
      564 : 189,
      565 : 189,
      566 : 189,
      567 : 189,
      568 : 189,
      569 : 189,
      570 : 189,
      571 : 189,
      572 : 189,
      573 : 189,
      574 : 189,
      575 : 189,
      576 : 189,
      577 : 189,
      578 : 189,
      579 : 189,
      580 : 190,
      581 : 190,
      582 : 190,
      583 : 190,
      584 : 190,
      585 : 190,
      586 : 190,
      587 : 190,
      588 : 190,
      589 : 190,
      590 : 190,
      591 : 190,
      592 : 190,
      593 : 190,
      594 : 190,
      595 : 190,
      596 : 190,
      597 : 190,
      598 : 190,
      599 : 190,
      600 : 191,
      601 : 191,
      602 : 191,
      603 : 191,
      604 : 191,
      605 : 191,
      606 : 191,
      607 : 191,
      608 : 191,
      609 : 191,
      610 : 191,
      611 : 191,
      612 : 191,
      613 : 191,
      614 : 191,
      615 : 191,
      616 : 191,
      617 : 191,
      618 : 191,
      619 : 191,
      620 : 192,
      621 : 192,
      622 : 192,
      623 : 192,
      624 : 192,
      625 : 192,
      626 : 192,
      627 : 192,
      628 : 192,
      629 : 192,
      630 : 192,
      631 : 192,
      632 : 192,
      633 : 192,
      634 : 192,
      635 : 192,
      636 : 192,
      637 : 192,
      638 : 192,
      639 : 192,
      640 : 193,
      641 : 193,
      642 : 193,
      643 : 193,
      644 : 193,
      645 : 193,
      646 : 193,
      647 : 193,
      648 : 193,
      649 : 193,
      650 : 193,
      651 : 193,
      652 : 193,
      653 : 193,
      654 : 193,
      655 : 193,
      656 : 193,
      657 : 193,
      658 : 193,
      659 : 193,
      660 : 194,
      661 : 194,
      662 : 194,
      663 : 194,
      664 : 194,
      665 : 194,
      666 : 194,
      667 : 194,
      668 : 194,
      669 : 194,
      670 : 194,
      671 : 194,
      672 : 194,
      673 : 194,
      674 : 194,
      675 : 194,
      676 : 194,
      677 : 194,
      678 : 194,
      679 : 194,
      680 : 195,
      681 : 195,
      682 : 195,
      683 : 195,
      684 : 195,
      685 : 195,
      686 : 195,
      687 : 195,
      688 : 195,
      689 : 195,
      690 : 195,
      691 : 195,
      692 : 195,
      693 : 195,
      694 : 195,
      695 : 195,
      696 : 195,
      697 : 195,
      698 : 195,
      699 : 195,
      700 : 196,
      701 : 196,
      702 : 196,
      703 : 196,
      704 : 196,
      705 : 196,
      706 : 196,
      707 : 196,
      708 : 196,
      709 : 196,
      710 : 196,
      711 : 196,
      712 : 196,
      713 : 196,
      714 : 196,
      715 : 196,
      716 : 196,
      717 : 196,
      718 : 196,
      719 : 196,
      720 : 197,
      721 : 197,
      722 : 197,
      723 : 197,
      724 : 197,
      725 : 197,
      726 : 197,
      727 : 197,
      728 : 197,
      729 : 197,
      730 : 197,
      731 : 197,
      732 : 197,
      733 : 197,
      734 : 197,
      735 : 197,
      736 : 197,
      737 : 197,
      738 : 197,
      739 : 197,
      740 : 198,
      741 : 198,
      742 : 198,
      743 : 198,
      744 : 198,
      745 : 198,
      746 : 198,
      747 : 198,
      748 : 198,
      749 : 198,
      750 : 198,
      751 : 198,
      752 : 198,
      753 : 198,
      754 : 198,
      755 : 198,
      756 : 198,
      757 : 198,
      758 : 198,
      759 : 198,
      760 : 199,
      761 : 199,
      762 : 199,
      763 : 199,
      764 : 199,
      765 : 199,
      766 : 199,
      767 : 199,
      768 : 199,
      769 : 199,
      770 : 199,
      771 : 199,
      772 : 199,
      773 : 199,
      774 : 199,
      775 : 199,
      776 : 199,
      777 : 199,
      778 : 199,
      779 : 199,
      780 : 200,
      781 : 200,
      782 : 200,
      783 : 200,
      784 : 200,
      785 : 200,
      786 : 200,
      787 : 200,
      788 : 200,
      789 : 200,
      790 : 200,
      791 : 200,
      792 : 200,
    }
  }),
  computed: {},
  watch: {
    //Watch for when user updates the stats on their build and update the statsum and defences accordingly
    characterStats: {
      handler(newVal) {
        // if (newVal.resistance !== oldVal.resistance) {
        //   this.characterResistanceStat = newVal.resistance
        // }
        this.characterResistanceStat = newVal.resistance
        this.getStatSum(newVal)
        this.calculateDefence(this.statSum, this.characterResistanceStat)
      },
      deep: true
    }
  },
  methods: {
    getStatSum(characterStats) {
      let sum = 0
      //Get the sum of all stats
      Object.keys(characterStats).forEach(key => {
        if (Number.isInteger(characterStats[key]) && key !== "level") {
          sum += characterStats[key]
        }
      })
      
      this.statSum = sum
    },
    calculateDefence(statSum, resistance) {
      let lookupIndex = statSum + resistance - 8
      console.log(lookupIndex)
      if (lookupIndex < 262) {
        console.log(lookupIndex)
        this.physicalDefence.physical = this.physicalDefenceTable[lookupIndex]
        this.physicalDefence.slash = this.physicalDefenceTable[lookupIndex]
        this.physicalDefence.strike = this.physicalDefenceTable[lookupIndex]
        this.physicalDefence.thrust = this.physicalDefenceTable[lookupIndex]
      } else {
        lookupIndex = statSum + resistance - 99
        console.log(lookupIndex)
        this.physicalDefence.physical = this.physicalDefence99Table[lookupIndex]
        this.physicalDefence.slash = this.physicalDefence99Table[lookupIndex]
        this.physicalDefence.strike = this.physicalDefence99Table[lookupIndex]
        this.physicalDefence.thrust = this.physicalDefence99Table[lookupIndex]
      }
    }
  },
  mounted() {
    console.log(this.characterStats)
    this.getStatSum(this.characterStats)
    this.characterResistanceStat = this.characterStats.resistance
    this.calculateDefence(this.statSum, this.characterResistanceStat)
  }
}
</script>

<style lang="scss">
.defence-stats {
  padding-top: 2em;
  table {
    tbody {
      tr.tr-subhead {
        padding-left: 2em;
      }
    }
  }
}
</style>